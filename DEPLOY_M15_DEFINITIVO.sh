#!/bin/bash
echo "ðŸš€ DEPLOY DEFINITIVO - MÃ“DULO 15"
echo "================================"

cd /home/user/studio

# Verificar URL canÃ´nica
if [ -f url_canonica.txt ]; then
    source url_canonica.txt
    echo "ðŸ“ Usando URL canÃ´nica: $URL_CANONICA"
else
    URL_CANONICA="https://fundacao-alquimista-anatheron-cprkux23i.vercel.app"
fi

# Atualizar .env.local com URL canÃ´nica
cat > .env.local << ENV
NEXTAUTH_URL=$URL_CANONICA
NEXTAUTH_SECRET=fundacao-alquimista-quantum-secret-2025
NODE_ENV=production
ENV

# Build final
echo "ï¿½ï¿½ Executando build definitivo..."
npm run build

if [ $? -eq 0 ]; then
    echo "âœ… BUILD DEFINITIVO BEM-SUCEDIDO!"
    
    # Deploy para URL canÃ´nica
    echo "ðŸš€ Implantando na URL canÃ´nica..."
    vercel --prod --yes
    
    echo ""
    echo "ðŸŽ‰ MÃ“DULO 15 IMPLANTADO DEFINITIVAMENTE!"
    echo "ï¿½ï¿½ URL: $URL_CANONICA"
    echo "ðŸ’« Sistema 100% consolidado!"
else
    echo "âŒ Erro no build definitivo"
    exit 1
fi
